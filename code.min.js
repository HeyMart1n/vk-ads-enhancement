var tableSelector="#exchange_comm_search_table",patchedClass="patched",cellSelector="tr[class] td:nth-child(4):not(."+patchedClass+") b";window.jQuery||function(){window.setTimeout(function(){var a=document;f=a.getElementsByTagName("script")[0];s=a.createElement("script");s.type="text/javascript";s.async=!0;s.src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js";f.parentNode.insertBefore(s,f)},1)}(); var getTypeOfPostsPerDay=function(a){a="undefined"!=typeof a?a:9999999;return 0<a&&5>=a?"success":5<a&&10>=a?"warning":"danger"},getColor=function(a){return{danger:"#CB0102",warning:"#F48900",success:"#2D7D2B"}[getTypeOfPostsPerDay(a)]},getWeight=function(a){return"success"==getTypeOfPostsPerDay(a)?"bold":"normal"},patch=function(a,c){console.log("patch!",a);a.each(function(){var a=c(this),b=a.text().split(" ").join("").split("/"),d=parseFloat(b[0]),b=parseFloat(b[1]),d=Math.round(10*parseFloat(b/ d))/10,b=c("<div/>");b.css({padding:"3px 10px",margin:"2px 0 0",background:getColor(d),color:"#fff",textAlign:"center",fontWeight:getWeight(d)}).html(d);a.closest("td").addClass("patched").append(b)})},tryCount=50,currentIter=0,timeout=200,check=function(){return"undefined"!=typeof window.jQuery},run=function(a){console.log("run!",a);var c="";window.setInterval(function(){var e=a(tableSelector),b=e.html();b==c?console.log("Nothing changes."):(c=b,console.log("Table changed!"),patch(e.find(cellSelector), a))},300)};interval=window.setInterval(function(){currentIter++;check()?(console.log(currentIter,"jQuery loaded."),window.clearInterval(interval),run(window.jQuery)):currentIter==tryCount&&(console.log(currentIter,"Failed load jQuery. Abort."),window.clearInterval(interval),alert("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c jQuery :-("))},200);
